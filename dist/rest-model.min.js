!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.RestModel=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./lib/utils");b.exports=Ember.Object.extend({isRestModelClass:!0,init:function(){this.setOriginalProperties(),this._definePrimaryKey(),this._defineDirtyProperties()},attrs:function(){return[]}.property(),inFlight:Ember.computed.bool("requestPool"),isClean:Ember.computed.empty("dirtyProperties"),isDirty:Ember.computed.notEmpty("dirtyProperties"),isNew:Ember.computed.none("primaryKey"),isPersisted:Ember.computed.not("isNew"),attrNames:function(){return this.get("attrs").map(function(a){return/\.\[\]$/.test(a)?a.split(".")[0]:a})}.property("attrs"),parents:function(){var a=this.constructor.getParentKeyNames();return a.reduce(function(a,b){return a[b]=this.get(b),a}.bind(this),{})}.property()["volatile"](),path:function(){var a=this.get("isPersisted")?this.get("primaryKey"):null,b=this.get("parents");return this.constructor.buildPath(b,a)}.property("isPersisted","primaryKey","parents"),"delete":function(a){return this.request("deleting",function(){return a=d.extend({url:this.get("path"),type:"DELETE"},a),this.constructor.ajax(a)}.bind(this))},fetch:function(a){return this.request("fetching",function(){return a=d.extend({url:this.get("path"),type:"GET"},a),this.constructor.request(a,{},this).then(function(a){var b=this.constructor.getUpdatableProperties(a);return this.setProperties(b),this.setOriginalProperties(),this}.bind(this))}.bind(this))},request:function(a,b){return a="is"+a.capitalize(),this.set(a,!0),this.incrementProperty("requestPool"),b()["finally"](function(){this.set(a,!1),this.decrementProperty("requestPool")}.bind(this))},revert:function(){var a=this.get("attrs");this.get("attrNames").forEach(function(b,c){var d=Ember.copy(this.get("originalProperties."+b));/\.\[\]$/.test(a[c])?this.get(b).setObjects(d):this.set(b,d)}.bind(this))},save:function(a){var b=this.get("isNew")?"POST":"PATCH";return this.request("saving",function(){return a=d.extend({url:this.get("path"),type:b,data:this.serialize()},a),this.constructor.ajax(a).then(function(a){return a.data}.bind(this)).then(function(a){return this.setProperties(a),this.setOriginalProperties(),this}.bind(this))}.bind(this))},setOriginalProperties:function(){var a=this.get("attrNames");this.set("originalProperties",a.reduce(function(a,b){var c=this.get(b);return a.set(b,Ember.copy(c,!0)),a}.bind(this),Ember.Object.create()))},getDirtyProperties:function(){var a=this.get("attrNames"),b=this.get("originalProperties");return a.reduce(function(a,c){var e=this.get(c),f=b.get(c);return Ember.isArray(e)?d.arraysEqual(e,f)||a.push(c):Ember.$.isPlainObject(e)?d.objectsEqual(e,f)||a.push(c):Ember.isEqual(e,f)||a.push(c),a}.bind(this),[])},serialize:function(){return JSON.stringify(this.toObject())},toObject:function(){return this.get("attrNames").reduce(function(a,b){var c=this.get(b);return a[b]=c,a}.bind(this),{})},_definePrimaryKey:function(){var a=this.constructor.primaryKeys,b=this.constructor.primaryKeys.concat({get:function(){for(var b,c,d=0;d<a.length;d++)if(b=a[d],c=this.get(b),!Ember.isNone(c))return c},set:function(b,c,d){return this.get("primaryKey")!==d&&this.set(a[0],d),d}}),c=Ember.computed.apply(Ember,b);Ember.defineProperty(this,"primaryKey",c)},_defineDirtyProperties:function(){var a=this.get("attrs").concat("originalProperties",this.getDirtyProperties),b=Ember.computed.apply(Ember,a);Ember.defineProperty(this,"dirtyProperties",b)}}).reopenClass({typeKey:"",primaryKeys:["id"],namespace:null,base:"",filters:[],ajax:function(a){var b={type:"GET",dataType:"json",contentType:"application/json"};return d.extend(b,a),new Ember.RSVP.Promise(function(a,c){Ember.$.ajax(b).then(function(b,c,d){d=d||{},b=Ember.isArray(b)?this.deserializeArray(b):this.deserialize(b),a({data:b,status:d.status})}.bind(this),function(a){delete a.then,c(a)})}.bind(this))},all:function(a,b){b=d.extend({url:this.buildPath(a),type:"GET"},b);var c={parents:a};return this.request(b,c).then(function(a){return a})},addParentsToPath:function(a,b){return Ember.$.each(a,function(a,c){var d=c;"string"!=typeof c&&"number"!=typeof c&&(d=c.get("primaryKey")),b=b.replace("/:"+a,"/"+d)}),b},assertHasParentKeys:function(a){this.getParentKeyNames().forEach(function(b){var c=a[b],d=c?this.getPrimaryKey(c):null;if(Ember.isNone(d))throw new Error('No primary key found for parent "'+b+'".')}.bind(this))},buildPath:function(a,b){var c="/"+this.base;return Ember.$.isPlainObject(a)||(b=a,a={}),this.assertHasParentKeys(a),c=this.addParentsToPath(a,c),Ember.isNone(b)||(c+="/"+b),Ember.isNone(this.namespace)||(c="/"+this.namespace+c),c},deserialize:function(a){return a},deserializeArray:function(a){return a.map(this.deserialize.bind(this))},find:function(a,b,c){return Ember.$.isPlainObject(a)||(c=b,b=a,a={}),c=d.extend({url:this.buildPath(a,b),type:"GET"},c),this.request(c).then(this.create.bind(this)).then(function(b){return b.setProperties(a),b})},getParentKeyNames:function(){var a=this.base.match(/\/:[^\/]+/g)||[];return a.map(function(a){return a.replace("/:","")})},getPrimaryKey:function(a){return"number"==typeof a||"string"==typeof a?a:a.get("primaryKey")},toResult:function(a,b){if(b=b||{},Ember.isArray(a)){var c=a.map(function(a){var c=this.create(a);return c.setProperties(b),c}.bind(this));return this.runFilters(c)}var d=this.create(a);return d.setProperties(b),d},replace:function(a,b,c){var d=this.filters;return d.forEach(function(a){c=c.filter(a)}),c},runFilters:function(a){return this.replace(0,a.length,a)}.observes("filters.[]"),request:function(a,b,c){return b=d.extend({toResult:this.toResult.bind(this)},b),this.ajax(a).then(function(d){a.returnPayload&&c.set("raw",d.data);var e=b.parents;return b.toResult(d.data,e)})},getUpdatableProperties:function(a){var b=Object.keys(a).filter(function(a){return-1===["primaryKey","originalProperties","dirtyProperties"].indexOf(a)});return a.getProperties(b)},create:function(a){if(a=a||{},a.isRestModelClass){var b={},c={};return Object.keys(a).forEach(function(d){var e=a[d];e instanceof Ember.ComputedProperty?c[d]=e:b[d]=e}),this.extend(c),this._super.call(this,b)}return this._super.call(this,a)}})},{"./lib/utils":2}],2:[function(a,b,c){"use strict";c.arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var c,d,e=0;e<a.length;e++)if(c=a[e],d=b[e],!Ember.isEqual(c,d))return!1;return!0},c.objectsEqual=function(a,b){if(!a||!b)return!1;var c=Object.keys(a),d=Object.keys(b),e=this.arraysEqual(c,d);if(e){var f=c.every(function(c){return a[c]===b[c]});return f}return!1},c.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},c.findMatching=function(a,b,c){var d=b.primaryKeys[0];return c.find(function(b){return a[d]===b[d]})},c.findIn=function(a,b,c){return a.reduce(function(a,d){var e=this.findMatching(d,c,b);return e&&a.push(d),a}.bind(this),[])},c.findNotIn=function(a,b,c){return a.reduce(function(a,d){var e=this.findMatching(d,c,b);return e||a.push(d),a}.bind(this),[])}},{}]},{},[1])(1)});