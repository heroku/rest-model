!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.RestModel=e()}}(function(){return function e(f,o,n){function d(t,l){if(!o[t]){if(!f[t]){var s="function"==typeof require&&require;if(!l&&s)return s(t,!0);if(i)return i(t,!0);throw new Error("Cannot find module '"+t+"'")}var u=o[t]={exports:{}};f[t][0].call(u.exports,function(e){var o=f[t][1][e];return d(o?o:e)},u,u.exports,e,f,o,n)}return o[t].exports}for(var i="function"==typeof require&&require,t=0;t<n.length;t++)d(n[t]);return d}({1:[function(e,f,o){"use strict";var n=e("./lib/utils"),d=Ember.observer,i=Ember.computed,t=Ember.String.capitalize;f.exports=Ember.Object.extend({isRestModelClass:!0,init:function(){this.setOriginalProperties(),this._definePrimaryKey(),this._defineDirtyProperties()},attrs:i(function(){return[]}),inFlight:Ember.computed.bool("requestPool"),isClean:Ember.computed.empty("dirtyProperties"),isDirty:Ember.computed.notEmpty("dirtyProperties"),isNew:Ember.computed.none("primaryKey"),isPersisted:Ember.computed.not("isNew"),attrNames:i("attrs",function(){return this.get("attrs").map(function(e){return/\.\[\]$/.test(e)?e.split(".")[0]:e})}),parents:i(function(){var e=this.constructor.getParentKeyNames();return e.reduce(function(e,f){return e[f]=this.get(f),e}.bind(this),{})})["volatile"](),path:i("isPersisted","primaryKey","parents",function(){var e=this.get("isPersisted")?this.get("primaryKey"):null,f=this.get("parents");return this.constructor.buildPath(f,e)}),"delete":function(e){return this.request("deleting",function(){return e=n.extend({url:this.get("path"),type:"DELETE"},e),this.constructor.ajax(e)}.bind(this))},fetch:function(e){return this.request("fetching",function(){return e=n.extend({url:this.get("path"),type:"GET"},e),this.constructor.request(e,{},this).then(function(e){var f=this.constructor.getUpdatableProperties(e);return this.setProperties(f),this.setOriginalProperties(),this}.bind(this))}.bind(this))},request:function(e,f){return e="is"+t(e),this.set(e,!0),this.incrementProperty("requestPool"),f()["finally"](function(){this.set(e,!1),this.decrementProperty("requestPool")}.bind(this))},revert:function(){var e=this.get("attrs");this.get("attrNames").forEach(function(f,o){var n=Ember.copy(this.get("originalProperties."+f));/\.\[\]$/.test(e[o])?this.get(f).setObjects(n):this.set(f,n)}.bind(this))},save:function(e){var f=this.get("isNew")?"POST":"PATCH";return this.request("saving",function(){return e=n.extend({url:this.get("path"),type:f,data:this.serialize()},e),this.constructor.ajax(e).then(function(e){return e.data}.bind(this)).then(function(e){return this.setProperties(e),this.setOriginalProperties(),this}.bind(this))}.bind(this))},setOriginalProperties:function(){var e=this.get("attrNames");this.set("originalProperties",e.reduce(function(e,f){var o=this.get(f);return e.set(f,Ember.copy(o,!0)),e}.bind(this),Ember.Object.create()))},getDirtyProperties:function(){var e=this.get("attrNames"),f=this.get("originalProperties");return e.reduce(function(e,o){var d=this.get(o),i=f.get(o);return Ember.isArray(d)?n.arraysEqual(d,i)||e.push(o):Ember.$.isPlainObject(d)?n.objectsEqual(d,i)||e.push(o):Ember.isEqual(d,i)||e.push(o),e}.bind(this),[])},serialize:function(){return JSON.stringify(this.toObject())},toObject:function(){return this.get("attrNames").reduce(function(e,f){var o=this.get(f);return e[f]=o,e}.bind(this),{})},_definePrimaryKey:function(){var e=this.constructor.primaryKeys,f=this.constructor.primaryKeys.concat({get:function(){for(var f,o,n=0;n<e.length;n++)if(f=e[n],o=this.get(f),!Ember.isNone(o))return o},set:function(f,o,n){return this.get("primaryKey")!==n&&this.set(e[0],n),n}}),o=Ember.computed.apply(Ember,f);Ember.defineProperty(this,"primaryKey",o)},_defineDirtyProperties:function(){var e=this.get("attrs").concat("originalProperties",this.getDirtyProperties),f=Ember.computed.apply(Ember,e);Ember.defineProperty(this,"dirtyProperties",f)}}).reopenClass({typeKey:"",primaryKeys:["id"],namespace:null,base:"",filters:[],ajax:function(e){var f={type:"GET",dataType:"json",contentType:"application/json"};return n.extend(f,e),new Ember.RSVP.Promise(function(e,o){Ember.$.ajax(f).then(function(f,o,n){n=n||{},f=Ember.isArray(f)?this.deserializeArray(f):this.deserialize(f),e({data:f,status:n.status})}.bind(this),function(e){delete e.then,o(e)})}.bind(this))},all:function(e,f){f=n.extend({url:this.buildPath(e),type:"GET"},f);var o={parents:e};return this.request(f,o).then(function(e){return e})},addParentsToPath:function(e,f){return Ember.$.each(e,function(e,o){var n=o;"string"!=typeof o&&"number"!=typeof o&&(n=o.get("primaryKey")),f=f.replace("/:"+e,"/"+n)}),f},assertHasParentKeys:function(e){this.getParentKeyNames().forEach(function(f){var o=e[f],n=o?this.getPrimaryKey(o):null;if(Ember.isNone(n))throw new Error('No primary key found for parent "'+f+'".')}.bind(this))},buildPath:function(e,f){var o="/"+this.base;return Ember.$.isPlainObject(e)||(f=e,e={}),this.assertHasParentKeys(e),o=this.addParentsToPath(e,o),Ember.isNone(f)||(o+="/"+f),Ember.isNone(this.namespace)||(o="/"+this.namespace+o),o},deserialize:function(e){return e},deserializeArray:function(e){return e.map(this.deserialize.bind(this))},find:function(e,f,o){return Ember.$.isPlainObject(e)||(o=f,f=e,e={}),o=n.extend({url:this.buildPath(e,f),type:"GET"},o),this.request(o).then(this.create.bind(this)).then(function(f){return f.setProperties(e),f})},getParentKeyNames:function(){var e=this.base.match(/\/:[^\/]+/g)||[];return e.map(function(e){return e.replace("/:","")})},getPrimaryKey:function(e){return"number"==typeof e||"string"==typeof e?e:e.get("primaryKey")},toResult:function(e,f){if(f=f||{},Ember.isArray(e)){var o=e.map(function(e){var o=this.create(e);return o.setProperties(f),o}.bind(this));return this.runFilters(o)}var n=this.create(e);return n.setProperties(f),n},replace:function(e,f,o){var n=this.filters;return n.forEach(function(e){o=o.filter(e)}),o},runFilters:d("filters.[]",function(e){return this.replace(0,e.length,e)}),request:function(e,f,o){return f=n.extend({toResult:this.toResult.bind(this)},f),this.ajax(e).then(function(n){e.returnPayload&&o.set("raw",n.data);var d=f.parents;return f.toResult(n.data,d)})},getUpdatableProperties:function(e){var f=Object.keys(e).filter(function(e){return-1===["primaryKey","originalProperties","dirtyProperties"].indexOf(e)});return e.getProperties(f)},create:function(e){if(e=e||{},e.isRestModelClass){var f={},o={};return Object.keys(e).forEach(function(n){var d=e[n];d instanceof Ember.ComputedProperty?o[n]=d:f[n]=d}),this.extend(o),this._super.call(this,f)}return this._super.call(this,e)}})},{"./lib/utils":2}],2:[function(e,f,o){"use strict";o.arraysEqual=function(e,f){if(e.length!==f.length)return!1;for(var o,n,d=0;d<e.length;d++)if(o=e[d],n=f[d],!Ember.isEqual(o,n))return!1;return!0},o.objectsEqual=function(e,f){if(!e||!f)return!1;var o=Object.keys(e),n=Object.keys(f),d=this.arraysEqual(o,n);if(d){var i=o.every(function(o){return e[o]===f[o]});return i}return!1},o.extend=function(e,f){for(var o in f)f.hasOwnProperty(o)&&(e[o]=f[o]);return e},o.findMatching=function(e,f,o){var n=f.primaryKeys[0];return o.find(function(f){return e[n]===f[n]})},o.findIn=function(e,f,o){return e.reduce(function(e,n){var d=this.findMatching(n,o,f);return d&&e.push(n),e}.bind(this),[])},o.findNotIn=function(e,f,o){return e.reduce(function(e,n){var d=this.findMatching(n,o,f);return d||e.push(n),e}.bind(this),[])}},{}]},{},[1])(1)});